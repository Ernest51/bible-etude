<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Test â€” /api/utils?action=health</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:20px;line-height:1.5}
    button{padding:8px 10px;border:1px solid #cbd5e1;border-radius:8px;cursor:pointer}
    .ok{color:#16a34a;font-weight:700}
    .ko{color:#b91c1c;font-weight:700}
    pre{white-space:pre-wrap;background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px}
    .muted{color:#64748b}
  </style>
</head>
<body>
  <h1>Test â€” /api/utils?action=health</h1>
  <p class="muted">VÃ©rifie que lâ€™endpoint rÃ©pond et que les variables dâ€™environnement api.bible sont bien dÃ©tectÃ©es.</p>
  <button id="run">Lancer le test</button>

  <div id="out" style="margin-top:16px"></div>

  <script>
    async function test(){
      const out = document.getElementById('out');
      out.innerHTML = 'RequÃªteâ€¦';
      try{
        const r = await fetch('/api/utils?action=health');
        const ct = (r.headers.get('content-type')||'').toLowerCase();
        if (!ct.includes('application/json')) {
          const text = await r.text();
          out.innerHTML = `<p class="ko">âŒ RÃ©ponse non-JSON (${r.status})</p><pre>${text.slice(0,600)}</pre>`;
          return;
        }
        const data = await r.json();
        const ok = data?.ok === true;
        const hasKey = !!data?.env?.hasApiBibleKey;
        const hasId  = !!data?.env?.hasApiBibleId;

        out.innerHTML = `
          <p class="${ok?'ok':'ko'}">${ok?'âœ…':'âŒ'} Endpoint OK</p>
          <p>${hasKey ? 'ğŸ”‘ API_BIBLE_KEY dÃ©tectÃ©e' : 'ğŸ”’ API_BIBLE_KEY absente â†’ fallback'}</p>
          <p>${hasId  ? 'ğŸ“– API_BIBLE_ID dÃ©tectÃ©'   : 'ğŸ“• API_BIBLE_ID absent â†’ fallback'}</p>
          <details><summary>DÃ©tails</summary><pre>${JSON.stringify(data,null,2)}</pre></details>
        `;
      }catch(e){
        document.getElementById('out').innerHTML = `<p class="ko">âŒ Erreur: ${e.message}</p>`;
      }
    }
    document.getElementById('run').addEventListener('click', test);
  </script>
</body>
</html>
