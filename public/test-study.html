<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Test API /api/chat (28 sections)</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; background: #f7f7f7; }
    h1 { font-size: 1.5rem; }
    form { margin-bottom: 1rem; }
    label { display: block; margin-top: 0.5rem; }
    textarea { width: 100%; height: 200px; }
    .section {
      background: #fff; margin: 1rem 0; padding: 1rem;
      border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .section h2 { margin: 0 0 0.5rem; font-size: 1.2rem; }
    pre { white-space: pre-wrap; word-wrap: break-word; }
  </style>
</head>
<body>
  <h1>Test rapide API Chat (28 sections)</h1>
  <form id="form">
    <label>Livre :
      <input type="text" name="book" value="Genèse" required>
    </label>
    <label>Chapitre :
      <input type="number" name="chapter" value="1" required>
    </label>
    <label>Traduction :
      <input type="text" name="translation" value="LSG">
    </label>
    <button type="submit">Lancer la requête</button>
  </form>

  <div id="output">Résultat…</div>

  <script>
  const form = document.getElementById("form");
  const out  = document.getElementById("output");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    out.textContent = "Chargement...";
    const formData = new FormData(form);
    const payload = {
      book: formData.get("book"),
      chapter: formData.get("chapter"),
      translation: formData.get("translation")
    };

    try {
      const res = await fetch("/api/chat", {
        method: "POST",
        headers: { "content-type": "application/json" },
        body: JSON.stringify(payload)
      });
      const data = await res.json();

      if (!data.ok) {
        out.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        return;
      }

      const sections = data.data?.sections || [];
      out.innerHTML = `<h2>Étude de ${data.data?.reference || ""}</h2>`;
      sections.forEach(sec => {
        const div = document.createElement("div");
        div.className = "section";
        div.innerHTML = `<h2>${sec.index}. ${sec.title}</h2><pre>${sec.content}</pre>`;
        out.appendChild(div);
      });
    } catch (err) {
      out.textContent = "Erreur: " + err.message;
    }
  });
  </script>
</body>
</html>
