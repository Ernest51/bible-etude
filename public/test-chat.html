<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>üîé Test /api/chat</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root { --bg:#0b1020; --fg:#e8edf8; --muted:#9fb0d0; --card:#131a33; }
  body{background:var(--bg); color:var(--fg); font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:24px}
  h1{font-size:20px; margin:0 0 12px}
  .bar button{padding:8px 12px; margin:0 8px 8px 0; border-radius:10px; border:1px solid #2f3b66; background:#1b2550; color:#fff; cursor:pointer}
  .bar button:hover{filter:brightness(1.15)}
  textarea{width:100%; height:200px; background:var(--card); color:var(--fg); border:1px solid #2f3b66; border-radius:10px; padding:12px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
  pre{background:var(--card); border:1px solid #2f3b66; border-radius:10px; padding:12px; overflow:auto; white-space:pre-wrap}
  .hint{color:var(--muted); margin:6px 0 14px}
</style>
</head>
<body>
  <h1>üîé Test /api/chat</h1>
  <div class="bar">
    <button id="btnProbe">Probe</button>
    <button id="btnGen1">Gen√®se&nbsp;1</button>
    <button id="btnJn316">Jean&nbsp;3:16</button>
    <button id="btnClear">Effacer</button>
    <a href="/test-chat-upload.html" style="margin-left:10px;color:#9dd3ff">‚û° test upload JSON</a>
  </div>

  <div class="hint">Colle/√©dite le JSON ci-dessous puis clique ¬´ POST /api/chat ¬ª.</div>
  <textarea id="payload"></textarea>
  <p class="bar"><button id="send">POST /api/chat</button></p>

  <h3>R√©ponse</h3>
  <pre id="out">‚Äî</pre>

<script>
const el = (id)=>document.getElementById(id);
const ta = el("payload"), out = el("out");

const tplProbe = { probe:true };
const tplGen1  = { book:"Gen√®se", chapter:1, verse:"", version:"LSG" };
const tplJn316 = { book:"Jean", chapter:3, verse:"16", version:"LSG",
  directives:{ priere_ouverture:"Faire court, centrer sur l'amour de Dieu et la foi, conclure par 'Amen.'" }
};

function set(v){ ta.value = JSON.stringify(v, null, 2); }
set(tplGen1);

el("btnProbe").onclick = ()=>set(tplProbe);
el("btnGen1").onclick  = ()=>set(tplGen1);
el("btnJn316").onclick = ()=>set(tplJn316);
el("btnClear").onclick = ()=>{ ta.value=""; out.textContent="‚Äî"; };

el("send").onclick = async () => {
  let payload;
  try { payload = JSON.parse(ta.value || "{}"); }
  catch (e) { out.textContent = "‚ùå JSON invalide : " + e.message; return; }

  out.textContent = "Envoi...";
  try {
    const res = await fetch("/api/chat", {
      method:"POST",
      headers:{ "content-type":"application/json" },
      body: JSON.stringify(payload)
    });
    const text = await res.text();
    let pretty = text;
    try {
      const json = JSON.parse(text);
      const sections = json?.data?.sections?.length;
      const badge = (sections!=null) ? `Sections: ${sections}` : "";
      pretty = `HTTP ${res.status} ${res.statusText}  ${badge}\n\n${JSON.stringify(json, null, 2)}`;
    } catch { pretty = `HTTP ${res.status} ${res.statusText}\n\n${text}`; }
    out.textContent = pretty;
  } catch (e) {
    out.textContent = "‚ùå Erreur r√©seau : " + e.message;
  }
};
</script>
</body>
</html>
