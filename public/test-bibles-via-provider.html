<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Test API.bible via Provider (FR)</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; background: #f7f7fb; }
    h1 { margin-bottom: 0.25rem; }
    .hint { color:#555; margin-bottom: 1rem; }
    .controls { display:flex; gap:0.5rem; margin:1rem 0; }
    input, button { padding: 0.6rem 0.8rem; font-size: 14px; }
    input { flex:1; border:1px solid #ddd; border-radius:8px; }
    button { border:none; background:#111; color:#fff; border-radius:8px; cursor:pointer; }
    button:disabled{ background:#aaa; cursor: not-allowed;}
    .list { background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 1rem; }
    .item { padding: 0.5rem 0; border-top: 1px dashed #eee; }
    .item:first-child { border-top: none; }
    .name { font-weight:600; }
    .meta { color:#666; font-size: 12px; }
    code { background:#f1f1f1; padding:2px 6px; border-radius:6px; }
    .empty { color:#a00; padding: 0.5rem 0; }
  </style>
</head>
<body>
  <h1>Test API.bible via /api/bibleProvider</h1>
  <p class="hint">Ce test utilise <code>/api/bibleProvider?action=bibles&language=fra</code> (côté serveur) pour lister les Bibles accessibles par ta clé.</p>

  <div class="controls">
    <input id="q" placeholder="Filtrer: ex. segond, LSG, darby, jérusalem…" />
    <button id="load">Charger la liste FR</button>
  </div>

  <div id="out" class="list">Clique sur “Charger la liste FR”…</div>

  <script>
    const out = document.getElementById("out");
    const btn = document.getElementById("load");
    const q   = document.getElementById("q");

    let all = [];

    function render(list) {
      if (!list.length) {
        out.innerHTML = `<div class="empty">Aucune Bible trouvée pour ce filtre.</div>`;
        return;
      }
      out.innerHTML = list.map(b => `
        <div class="item">
          <div class="name">${b.name}</div>
          <div class="meta">
            Abréviation: <code>${b.abbreviation || "—"}</code> ·
            Langue: <code>${b.language || "?"}</code> ·
            ID: <code>${b.id}</code>
          </div>
          ${b.description ? `<div class="meta">${b.description}</div>` : ""}
        </div>
      `).join("");
    }

    q.addEventListener("input", () => {
      const term = q.value.trim().toLowerCase();
      if (!term) return render(all);
      const filtered = all.filter(b =>
        (b.name || "").toLowerCase().includes(term) ||
        (b.abbreviation || "").toLowerCase().includes(term) ||
        (b.id || "").toLowerCase().includes(term)
      );
      render(filtered);
    });

    btn.addEventListener("click", async () => {
      btn.disabled = true;
      out.textContent = "Chargement…";
      try {
        const res = await fetch("/api/bibleProvider?action=bibles&language=fra");
        const j = await res.json();
        if (!res.ok || !j.ok) {
          out.innerHTML = `<div class="empty">Erreur: ${res.status} → ${j.error || "inconnue"}</div>`;
          btn.disabled = false;
          return;
        }
        all = j.data?.bibles || [];
        render(all);
      } catch (e) {
        out.innerHTML = `<div class="empty">Erreur réseau: ${e.message}</div>`;
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
