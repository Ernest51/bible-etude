<!doctype html>
<html lang="fr" data-theme="cyan">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Étude Biblique</title>

  <!-- (Optionnel) ta feuille tailwind générée ; présente dans /public/dist/output.css -->
  <link rel="stylesheet" href="/dist/output.css" />

  <style>
    /* Styles très légers pour ne pas interférer avec ton app */
    :root { --brand:#06b6d4; --ink:#0f172a; --muted:#64748b; --card:#ffffff; --border:#e5e7eb; }
    body { margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; color:var(--ink); background:#f8fafc; }
    .container { max-width: 1100px; margin: 0 auto; padding: 20px 16px 64px; }
    header { padding: 14px 0; background: #fff; border-bottom: 1px solid var(--border); }
    header .brand { display:flex; align-items:center; gap:10px; font-weight:700; color: var(--ink); }
    header .brand .dot { width:10px; height:10px; border-radius:50%; background:var(--brand); display:inline-block; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px; }
    .btn { background:var(--brand); color:#fff; border:0; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer; }
    .btn:disabled { opacity:.6; cursor:not-allowed; }
    input, select { border:1px solid var(--border); border-radius:8px; padding:8px 10px; }
    .stack { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    .muted { color:var(--muted); font-size:12px; }
  </style>
</head>

<body>
  <!-- Barre simple -->
  <header>
    <div class="container">
      <div class="brand">
        <span class="dot"></span>
        <span>Étude Biblique — Méditation</span>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- ======== TON APP EXISTANTE ======== -->
    <!-- Si ton app cible un autre id, ce bloc est neutre. -->
    <section class="card" style="margin-bottom:16px">
      <h2 style="margin:0 0 10px">Application</h2>
      <div id="app"></div>
    </section>

    <!-- Scripts de ton app (inchangés) -->
    <script defer src="/app-loader.js"></script>
    <script defer src="/app.js"></script>

    <!-- ======== WIDGET EXPLICATION (nouveau, autonome) ======== -->
    <section class="card" id="explain-widget" style="margin-top:16px">
      <h2 style="margin:0 0 12px">Lecture + Explication</h2>
      <div class="stack" style="margin-bottom:8px">
        <input id="x-book" placeholder="Livre (ex : Josué)" />
        <input id="x-ch" type="number" min="1" placeholder="Chapitre" style="width:120px" />
        <input id="x-v" placeholder="Versets (ex : 1-3,7)" style="width:180px" />
        <button id="x-run" class="btn">Lire & Expliquer</button>
        <span id="x-status" class="muted"></span>
      </div>
      <div id="x-out"></div>
    </section>

    <!-- JS du widget (n’interfère pas avec app.js) -->
    <script>
      (function () {
        const $ = (s, r = document) => r.querySelector(s);
        const out = $("#x-out"), status = $("#x-status");

        function card(html) {
          return `<div style="border:1px solid #e5e7eb;border-radius:12px;padding:12px 14px;margin:10px 0;background:#fff">${html}</div>`;
        }

        function renderExplain(data) {
          const { reference, items } = data;
          const head = `<h3 style="margin:6px 0 10px;color:#0e7490">${reference}</h3>`;
          const blocks = items.map((it) => {
            const verse = it.v ? `<div style="font-weight:700;color:#334155">v.${it.v}</div>` : "";
            return card(`
              ${verse}
              <p style="margin:6px 0 10px;color:#111827">${it.text}</p>
              <div class="explain-html" style="color:#1f2937">${it.html}</div>
            `);
          }).join("");
          out.innerHTML = head + blocks;
        }

        async function runExplain({ book, chapter, verse }) {
          status.textContent = "Chargement…";
          out.innerHTML = "";
          try {
            const qs = new URLSearchParams({ book, chapter, verse });
            const r = await fetch(`/api/explain?${qs.toString()}`);
            if (!r.ok) throw new Error(await r.text());
            const j = await r.json();
            if (!j.ok) throw new Error(j.error || "Erreur inconnue");
            renderExplain(j.data);
            status.textContent = "";
          } catch (e) {
            status.textContent = "Erreur";
            out.innerHTML = card(`<p style="color:#b91c1c"><strong>Oops :</strong> ${String(e.message || e)}</p>`);
          }
        }

        // Bouton du widget
        $("#x-run")?.addEventListener("click", () => {
          const book = $("#x-book").value.trim();
          const chapter = $("#x-ch").value.trim();
          const verse = ($("#x-v").value || "").trim();
          if (!book || !chapter) {
            out.innerHTML = card(`<p style="color:#b91c1c">Livre et chapitre sont requis.</p>`);
            return;
          }
          runExplain({ book, chapter, verse });
        });

        // API publique pour ton app existante (si tu veux déclencher depuis app.js)
        window.renderMeditationExplain = (book, chapter, verse = "") =>
          runExplain({ book, chapter, verse });
      })();
    </script>
  </main>
</body>
</html>
