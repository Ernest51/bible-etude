<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bible Ã‰tude</title>
  <meta name="description" content="Ã‰tude biblique â€” site statique" />
  <!-- EmpÃªche l'erreur 404 du favicon -->
  <link rel="icon" href="data:," />

  <style>
    html, body { margin:0; padding:0; height:100%; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#f7f7f8; color:#111; }
    header { padding:24px 16px; background:#fff; box-shadow: 0 1px 0 rgba(0,0,0,.06); position: sticky; top:0; z-index: 10; }
    .container { max-width: 960px; margin: 0 auto; }
    h1 { margin:0 0 8px; font-size: 24px; }
    p.lead { margin:0; color:#555; }
    main { padding: 24px 16px; }
    .card { background:#fff; border:1px solid #e6e6e6; border-radius: 12px; padding:16px; box-shadow: 0 1px 2px rgba(0,0,0,.03); }
    .row { display:flex; gap:16px; flex-wrap: wrap; }
    .col { flex:1 1 280px; min-width:280px; }
    /* Bouton Debug vert */
    #debugBtn {
      display:inline-flex; align-items:center; gap:8px;
      background:#16a34a; color:#fff; border:none; border-radius:10px;
      padding:12px 16px; font-weight:600; cursor:pointer;
      box-shadow: 0 2px 0 #0e7a36;
    }
    #debugBtn:active { transform: translateY(1px); box-shadow: 0 1px 0 #0e7a36; }

    /* Panneau debug */
    #debugPanel {
      margin-top:16px; display:none;
      background:#0b1020; color:#e2e8f0; border-radius:10px; padding:12px;
      border:1px solid #1f2a44; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      max-height: 320px; overflow:auto; white-space: pre-wrap;
    }
    .muted { color:#666; font-size:14px; margin-top:6px; }
    a { color:#2563eb; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body class="h-full">
  <header>
    <div class="container">
      <h1>Bible Ã‰tude</h1>
      <p class="lead">Interface statique prÃªte pour Vercel, avec outils de debug intÃ©grÃ©s.</p>
    </div>
  </header>

  <main>
    <div class="container row">
      <div class="col">
        <div class="card">
          <h2 style="margin:0 0 8px;">Bienvenue</h2>
          <p style="margin:0 0 12px;">
            Cette page sert dâ€™enveloppe statique. Le bouton ci-dessous lance des diagnostics
            utiles (chargement du JS, chemins, endpoints API Ã©ventuels).
          </p>
          <!-- Fallback onclick direct pour garantir le clic mÃªme si Ã©couteur non attachÃ© -->
          <button id="debugBtn" type="button" aria-controls="debugPanel" aria-expanded="false" onclick="window.__toggleDebug && window.__toggleDebug()">
            âœ… Ouvrir le Debug
          </button>
          <div id="debugPanel" role="region" aria-live="polite"></div>
          <p class="muted">Astuce : si tu utilises une API, assure-toi dâ€™avoir un dossier <code>/api</code> avec des fonctions serverless ou un endpoint externe valide.</p>
        </div>
      </div>

      <div class="col">
        <div class="card">
          <h2 style="margin:0 0 8px;">Contenu</h2>
          <p style="margin:0 0 12px;">Ajoute ici tes sections (lecture, plan dâ€™Ã©tude, etc.).</p>
          <ul style="margin:0 0 0 16px;">
            <li>Statique prÃªt Ã  dÃ©ployer</li>
            <li>Aucun framework requis</li>
            <li>Debug intÃ©grÃ©</li>
          </ul>
        </div>
      </div>
    </div>
  </main>

  <!-- JS inline pour Ã©liminer tout souci de chemin/caching -->
  <script>
    (function () {
      const state = { logs: [], ranAtLeastOnce: false };

      function byId(id) { return document.getElementById(id); }
      function append(text) {
        const line = '[' + new Date().toISOString() + '] ' + text;
        state.logs.push(line);
        const panel = byId('debugPanel');
        if (panel) panel.textContent = state.logs.join('\n');
        console.log(line);
      }

      async function safeFetch(url, options, timeoutMs) {
        const controller = new AbortController();
        const t = setTimeout(function(){ controller.abort(); }, timeoutMs || 3000);
        try {
          const res = await fetch(url, Object.assign({ signal: controller.signal }, options || {}));
          clearTimeout(t);
          let text = '';
          try { text = await res.text(); } catch(e) {}
          return { ok: res.ok, status: res.status, url: url, text: text };
        } catch (err) {
          clearTimeout(t);
          return { ok: false, status: 0, url: url, error: String(err) };
        }
      }

      async function runDiagnostics() {
        append('--- DÃ‰BUT DIAGNOSTIC ---');
        try {
          append('JS inline actif âœ…');
          append('UserAgent: ' + navigator.userAgent);
          append('Location: ' + window.location.href);

          // Tester quelques endpoints Ã©ventuels
          const candidates = ['/api/health', '/api/chat', '/api/ping'];
          for (const path of candidates) {
            const res = await safeFetch(path, { method: 'GET' }, 2500);
            if (res.ok) {
              append('Endpoint OK ' + path + ' â†’ ' + res.status);
            } else {
              append('Endpoint KO ' + path + ' â†’ ' + res.status + (res.error ? ' (' + res.error + ')' : ''));
            }
          }

          append('Header prÃ©sent: ' + Boolean(document.querySelector('header')));
        } catch (e) {
          append('Erreur inattendue: ' + String(e));
        } finally {
          append('--- FIN DIAGNOSTIC ---');
          state.ranAtLeastOnce = true;
        }
      }

      function toggle() {
        const btn = byId('debugBtn');
        const panel = byId('debugPanel');
        if (!btn || !panel) {
          console.error('Ã‰lÃ©ments debug introuvables');
          return;
        }
        const isOpen = panel.style.display === 'block';
        if (isOpen) {
          panel.style.display = 'none';
          btn.setAttribute('aria-expanded', 'false');
          btn.textContent = 'âœ… Ouvrir le Debug';
        } else {
          panel.style.display = 'block';
          btn.setAttribute('aria-expanded', 'true');
          btn.textContent = 'Fermer le Debug';
          if (state.logs.length === 0) panel.textContent = '[' + new Date().toISOString() + '] Debug dÃ©marrÃ©â€¦';
          runDiagnostics();
        }
      }

      function init() {
        const btn = byId('debugBtn');
        const panel = byId('debugPanel');
        if (!btn || !panel) return;

        panel.style.display = 'none';
        btn.setAttribute('aria-expanded', 'false');
        btn.addEventListener('click', toggle);
        window.__toggleDebug = toggle; // fallback pour l'attribut onclick
        console.log('ðŸŸ¢ Debug prÃªt â€” clique sur le bouton.');
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
